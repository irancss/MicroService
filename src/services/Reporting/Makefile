# Reporting Microservice Makefile
# Ø§ÛŒÙ† Makefile Ø´Ø§Ù…Ù„ ØªÙ…Ø§Ù… Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ØŒ Ø¨ÛŒÙ„Ø¯ØŒ ØªØ³Øª Ùˆ Ø¯ÛŒÙ¾Ù„ÙˆÛŒ Ø³Ø±ÙˆÛŒØ³ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯

# Ù…ØªØºÛŒØ±Ù‡Ø§
SOLUTION_NAME = Reporting.sln
SOLUTION_PATH = .
API_PROJECT = ReportingService.API
DOMAIN_PROJECT = ReportingService.Domain  
APPLICATION_PROJECT = ReportingService.Application
INFRASTRUCTURE_PROJECT = ReportingService.Infrastructure

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Docker
DOCKER_IMAGE_NAME = reporting-service
DOCKER_TAG = latest
DOCKER_REGISTRY = localhost:5000

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯ÛŒØªØ§Ø¨ÛŒØ³
DB_CONNECTION_STRING = "Host=localhost;Database=ReportingService_Dev;Username=reporting_user;Password=reporting_pass;"
HANGFIRE_DB_CONNECTION_STRING = "Host=localhost;Database=ReportingService_Hangfire_Dev;Username=reporting_user;Password=reporting_pass;"

# Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[1;33m
BLUE = \033[0;34m
NC = \033[0m # No Color

.PHONY: help install build test clean run dev deploy docker-build docker-run setup-db migrate create-migration

# Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù‡Ù†Ù…Ø§
help: ## Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¯Ø³ØªÙˆØ±Ø§Øª
	@echo "$(BLUE)ğŸ“‹ Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ:$(NC)"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "$(GREEN)%-20s$(NC) %s\n", $$1, $$2}'
	@echo ""

# Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
install: ## Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ Ùˆ packages
	@echo "$(YELLOW)ğŸ“¦ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§...$(NC)"
	dotnet restore $(SOLUTION_PATH)
	@echo "$(GREEN)âœ… ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ Ù†ØµØ¨ Ø´Ø¯Ù†Ø¯$(NC)"

# Ø¨ÛŒÙ„Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡
build: ## Ø¨ÛŒÙ„Ø¯ ØªÙ…Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§
	@echo "$(YELLOW)ğŸ”¨ Ø´Ø±ÙˆØ¹ Ø¨ÛŒÙ„Ø¯...$(NC)"
	dotnet build $(SOLUTION_PATH) --configuration Release --no-restore
	@echo "$(GREEN)âœ… Ø¨ÛŒÙ„Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯$(NC)"

# Ø¨ÛŒÙ„Ø¯ Ø³Ø±ÛŒØ¹ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡
build-dev: ## Ø¨ÛŒÙ„Ø¯ Ø³Ø±ÛŒØ¹ Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡
	@echo "$(YELLOW)ğŸ”¨ Ø¨ÛŒÙ„Ø¯ Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡...$(NC)"
	dotnet build $(SOLUTION_PATH) --configuration Debug --no-restore
	@echo "$(GREEN)âœ… Ø¨ÛŒÙ„Ø¯ ØªÙˆØ³Ø¹Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯$(NC)"

# ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ„Ø¯
clean: ## ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ„Ø¯
	@echo "$(YELLOW)ğŸ§¹ ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ...$(NC)"
	dotnet clean $(SOLUTION_PATH)
	rm -rf **/bin **/obj
	@echo "$(GREEN)âœ… ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯$(NC)"

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
test: ## Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§
	@echo "$(YELLOW)ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...$(NC)"
	dotnet test $(SOLUTION_PATH) --configuration Release --no-build --verbosity normal
	@echo "$(GREEN)âœ… ØªØ³Øªâ€ŒÙ‡Ø§ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù†Ø¯$(NC)"

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ coverage
test-coverage: ## Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ú¯Ø²Ø§Ø±Ø´ coverage
	@echo "$(YELLOW)ğŸ§ª Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ coverage...$(NC)"
	dotnet test $(SOLUTION_PATH) --collect:"XPlat Code Coverage" --results-directory ./TestResults/
	@echo "$(GREEN)âœ… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ coverage Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù†Ø¯$(NC)"

# Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
run: ## Ø§Ø¬Ø±Ø§ÛŒ API Ø¯Ø± Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡
	@echo "$(YELLOW)ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³...$(NC)"
	cd $(API_PROJECT) && dotnet run --configuration Debug
	@echo "$(GREEN)âœ… Ø³Ø±ÙˆÛŒØ³ Ù…ØªÙˆÙ‚Ù Ø´Ø¯$(NC)"

# Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø± Ø­Ø§Ù„Øª production
run-prod: ## Ø§Ø¬Ø±Ø§ÛŒ API Ø¯Ø± Ù…Ø­ÛŒØ· production
	@echo "$(YELLOW)ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø¯Ø± Ø­Ø§Ù„Øª production...$(NC)"
	cd $(API_PROJECT) && dotnet run --configuration Release --environment Production
	@echo "$(GREEN)âœ… Ø³Ø±ÙˆÛŒØ³ Ù…ØªÙˆÙ‚Ù Ø´Ø¯$(NC)"

# Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª watch
dev: ## Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø§ auto-reload (Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡)
	@echo "$(YELLOW)ğŸ‘¨â€ğŸ’» Ø§Ø¬Ø±Ø§ÛŒ Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡ Ø¨Ø§ auto-reload...$(NC)"
	cd $(API_PROJECT) && dotnet watch run
	@echo "$(GREEN)âœ… Ø­Ø§Ù„Øª ØªÙˆØ³Ø¹Ù‡ Ù…ØªÙˆÙ‚Ù Ø´Ø¯$(NC)"

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
setup-db: ## Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ùˆ Ø§ÛŒØ¬Ø§Ø¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³â€ŒÙ‡Ø§
	@echo "$(YELLOW)ğŸ—„ï¸  Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³â€ŒÙ‡Ø§...$(NC)"
	@echo "$(BLUE)Ø§ÛŒØ¬Ø§Ø¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ReportingService...$(NC)"
	-createdb -h localhost -U postgres ReportingService_Dev
	@echo "$(BLUE)Ø§ÛŒØ¬Ø§Ø¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Hangfire...$(NC)"
	-createdb -h localhost -U postgres ReportingService_Hangfire_Dev
	@echo "$(GREEN)âœ… Ø¯ÛŒØªØ§Ø¨ÛŒØ³â€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù†Ø¯$(NC)"

# Ø§Ø¬Ø±Ø§ÛŒ migrations
migrate: ## Ø§Ø¬Ø±Ø§ÛŒ database migrations
	@echo "$(YELLOW)ğŸ“Š Ø§Ø¬Ø±Ø§ÛŒ migrations...$(NC)"
	cd $(INFRASTRUCTURE_PROJECT) && dotnet ef database update --startup-project ../$(API_PROJECT)
	@echo "$(GREEN)âœ… Migrations Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù†Ø¯$(NC)"

# Ø§ÛŒØ¬Ø§Ø¯ migration Ø¬Ø¯ÛŒØ¯
create-migration: ## Ø§ÛŒØ¬Ø§Ø¯ migration Ø¬Ø¯ÛŒØ¯ (NAME=migration_name)
	@echo "$(YELLOW)ğŸ“ Ø§ÛŒØ¬Ø§Ø¯ migration Ø¬Ø¯ÛŒØ¯...$(NC)"
	@if [ -z "$(NAME)" ]; then \
		echo "$(RED)âŒ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… migration Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯: make create-migration NAME=YourMigrationName$(NC)"; \
		exit 1; \
	fi
	cd $(INFRASTRUCTURE_PROJECT) && dotnet ef migrations add $(NAME) --startup-project ../$(API_PROJECT)
	@echo "$(GREEN)âœ… Migration $(NAME) Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯$(NC)"

# Ø­Ø°Ù Ø¢Ø®Ø±ÛŒÙ† migration
remove-migration: ## Ø­Ø°Ù Ø¢Ø®Ø±ÛŒÙ† migration
	@echo "$(YELLOW)ğŸ—‘ï¸  Ø­Ø°Ù Ø¢Ø®Ø±ÛŒÙ† migration...$(NC)"
	cd $(INFRASTRUCTURE_PROJECT) && dotnet ef migrations remove --startup-project ../$(API_PROJECT)
	@echo "$(GREEN)âœ… Ø¢Ø®Ø±ÛŒÙ† migration Ø­Ø°Ù Ø´Ø¯$(NC)"

# Ø§ÛŒØ¬Ø§Ø¯ Docker image
docker-build: ## Ø§ÛŒØ¬Ø§Ø¯ Docker image
	@echo "$(YELLOW)ğŸ³ Ø§ÛŒØ¬Ø§Ø¯ Docker image...$(NC)"
	docker build -t $(DOCKER_IMAGE_NAME):$(DOCKER_TAG) .
	@echo "$(GREEN)âœ… Docker image Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯$(NC)"

# Ø§Ø¬Ø±Ø§ÛŒ container
docker-run: ## Ø§Ø¬Ø±Ø§ÛŒ Docker container
	@echo "$(YELLOW)ğŸ³ Ø§Ø¬Ø±Ø§ÛŒ Docker container...$(NC)"
	docker run -d --name reporting-service-container \
		-p 8080:80 \
		-e ASPNETCORE_ENVIRONMENT=Production \
		-e ConnectionStrings__DefaultConnection="$(DB_CONNECTION_STRING)" \
		-e ConnectionStrings__HangfireConnection="$(HANGFIRE_DB_CONNECTION_STRING)" \
		$(DOCKER_IMAGE_NAME):$(DOCKER_TAG)
	@echo "$(GREEN)âœ… Container Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª$(NC)"

# Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† container
docker-stop: ## Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† Docker container
	@echo "$(YELLOW)ğŸ›‘ Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† container...$(NC)"
	-docker stop reporting-service-container
	-docker rm reporting-service-container
	@echo "$(GREEN)âœ… Container Ù…ØªÙˆÙ‚Ù Ø´Ø¯$(NC)"

# Ù…Ø´Ø§Ù‡Ø¯Ù‡ logs
docker-logs: ## Ù…Ø´Ø§Ù‡Ø¯Ù‡ logs container
	@echo "$(YELLOW)ğŸ“‹ Ù†Ù…Ø§ÛŒØ´ logs...$(NC)"
	docker logs -f reporting-service-container

# push Ú©Ø±Ø¯Ù† image Ø¨Ù‡ registry
docker-push: ## push Ú©Ø±Ø¯Ù† image Ø¨Ù‡ registry
	@echo "$(YELLOW)ğŸ“¤ push Ú©Ø±Ø¯Ù† image...$(NC)"
	docker tag $(DOCKER_IMAGE_NAME):$(DOCKER_TAG) $(DOCKER_REGISTRY)/$(DOCKER_IMAGE_NAME):$(DOCKER_TAG)
	docker push $(DOCKER_REGISTRY)/$(DOCKER_IMAGE_NAME):$(DOCKER_TAG)
	@echo "$(GREEN)âœ… Image push Ø´Ø¯$(NC)"

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· Ú©Ø§Ù…Ù„ Ø¨Ø§ Docker Compose
compose-up: ## Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· Ú©Ø§Ù…Ù„ Ø¨Ø§ Docker Compose
	@echo "$(YELLOW)ğŸ³ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· Ú©Ø§Ù…Ù„...$(NC)"
	docker-compose up -d
	@echo "$(GREEN)âœ… Ù…Ø­ÛŒØ· Ú©Ø§Ù…Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯$(NC)"
	@echo "$(BLUE)ğŸ“‹ Swagger UI: http://localhost:8080$(NC)"
	@echo "$(BLUE)ğŸ“‹ Hangfire Dashboard: http://localhost:8080/hangfire$(NC)"

# Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† Docker Compose
compose-down: ## Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† Docker Compose
	@echo "$(YELLOW)ğŸ›‘ Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† Ù…Ø­ÛŒØ·...$(NC)"
	docker-compose down
	@echo "$(GREEN)âœ… Ù…Ø­ÛŒØ· Ù…ØªÙˆÙ‚Ù Ø´Ø¯$(NC)"

# Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆØ¶Ø¹ÛŒØª services
compose-status: ## Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª services
	@echo "$(YELLOW)ğŸ“Š ÙˆØ¶Ø¹ÛŒØª services:$(NC)"
	docker-compose ps

# Ù†Ù…Ø§ÛŒØ´ logs ØªÙ…Ø§Ù… services
compose-logs: ## Ù†Ù…Ø§ÛŒØ´ logs ØªÙ…Ø§Ù… services
	@echo "$(YELLOW)ğŸ“‹ Ù†Ù…Ø§ÛŒØ´ logs:$(NC)"
	docker-compose logs -f

# ØªÙˆÙ„ÛŒØ¯ sample data Ø¨Ø±Ø§ÛŒ ØªØ³Øª
generate-test-data: ## ØªÙˆÙ„ÛŒØ¯ Ù†Ù…ÙˆÙ†Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ØªØ³Øª
	@echo "$(YELLOW)ğŸ“Š ØªÙˆÙ„ÛŒØ¯ Ù†Ù…ÙˆÙ†Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...$(NC)"
	curl -X POST "http://localhost:5000/api/testdata/generate-sample-orders/50" \
		-H "Content-Type: application/json"
	@echo "$(GREEN)âœ… Ù†Ù…ÙˆÙ†Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù†Ø¯$(NC)"

# Ø§Ø¬Ø±Ø§ÛŒ aggregation Ø¯Ø³ØªÛŒ
run-aggregation: ## Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ daily sales aggregation
	@echo "$(YELLOW)ğŸ“Š Ø§Ø¬Ø±Ø§ÛŒ aggregation...$(NC)"
	curl -X POST "http://localhost:5000/api/datamanagement/aggregate/daily/$$(date -d yesterday +%Y-%m-%d)" \
		-H "Content-Type: application/json"
	@echo "$(GREEN)âœ… Aggregation Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯$(NC)"

# Ø¨Ø±Ø±Ø³ÛŒ health
health-check: ## Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆÛŒØ³
	@echo "$(YELLOW)ğŸ¥ Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆÛŒØ³...$(NC)"
	curl -s http://localhost:5000/health | jq '.'
	@echo "$(GREEN)âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯$(NC)"

# Ù†Ù…Ø§ÛŒØ´ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§
show-metrics: ## Ù†Ù…Ø§ÛŒØ´ sample reports
	@echo "$(YELLOW)ğŸ“Š Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡...$(NC)"
	@echo "$(BLUE)ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ 30 Ø±ÙˆØ² Ø§Ø®ÛŒØ±:$(NC)"
	curl -s "http://localhost:5000/api/salesreports/daily/last30days" | jq '.summary'
	@echo ""
	@echo "$(BLUE)ğŸ† Ù…Ø­ØµÙˆÙ„Ø§Øª Ù¾Ø±ÙØ±ÙˆØ´:$(NC)"
	curl -s "http://localhost:5000/api/productanalytics/top-selling/last30days?topCount=5" | jq '.products[] | {productName, totalRevenue, rank}'

# backup Ø¯ÛŒØªØ§Ø¨ÛŒØ³
backup-db: ## ØªÙ‡ÛŒÙ‡ backup Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
	@echo "$(YELLOW)ğŸ’¾ ØªÙ‡ÛŒÙ‡ backup...$(NC)"
	pg_dump -h localhost -U postgres -d ReportingService_Dev > backup_$$(date +%Y%m%d_%H%M%S).sql
	@echo "$(GREEN)âœ… Backup ØªÙ‡ÛŒÙ‡ Ø´Ø¯$(NC)"

# restore Ø¯ÛŒØªØ§Ø¨ÛŒØ³
restore-db: ## Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ø² backup (FILE=backup.sql)
	@echo "$(YELLOW)ğŸ”„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³...$(NC)"
	@if [ -z "$(FILE)" ]; then \
		echo "$(RED)âŒ Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ backup Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯: make restore-db FILE=backup.sql$(NC)"; \
		exit 1; \
	fi
	psql -h localhost -U postgres -d ReportingService_Dev < $(FILE)
	@echo "$(GREEN)âœ… Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯$(NC)"

# Ø¨Ø±Ø±Ø³ÛŒ Ú©ÛŒÙÛŒØª Ú©Ø¯
lint: ## Ø¨Ø±Ø±Ø³ÛŒ Ú©ÛŒÙÛŒØª Ú©Ø¯
	@echo "$(YELLOW)ğŸ” Ø¨Ø±Ø±Ø³ÛŒ Ú©ÛŒÙÛŒØª Ú©Ø¯...$(NC)"
	dotnet format $(SOLUTION_PATH) --verify-no-changes
	@echo "$(GREEN)âœ… Ú©ÛŒÙÛŒØª Ú©Ø¯ Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¯$(NC)"

# ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ú©Ø¯
format: ## ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ú©Ø¯
	@echo "$(YELLOW)âœ¨ ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ú©Ø¯...$(NC)"
	dotnet format $(SOLUTION_PATH)
	@echo "$(GREEN)âœ… Ú©Ø¯ ÙØ±Ù…Øª Ø´Ø¯$(NC)"

# Ø¢Ù†Ø§Ù„ÛŒØ² Ø§Ù…Ù†ÛŒØªÛŒ
security-scan: ## Ø§Ø³Ú©Ù† Ø§Ù…Ù†ÛŒØªÛŒ dependencies
	@echo "$(YELLOW)ğŸ” Ø§Ø³Ú©Ù† Ø§Ù…Ù†ÛŒØªÛŒ...$(NC)"
	dotnet list $(SOLUTION_PATH) package --vulnerable
	@echo "$(GREEN)âœ… Ø§Ø³Ú©Ù† Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯$(NC)"

# Ø¨Ø±Ø±Ø³ÛŒ outdated packages
check-updates: ## Ø¨Ø±Ø±Ø³ÛŒ packages Ù‚Ø¯ÛŒÙ…ÛŒ
	@echo "$(YELLOW)ğŸ“¦ Ø¨Ø±Ø±Ø³ÛŒ packages Ù‚Ø¯ÛŒÙ…ÛŒ...$(NC)"
	dotnet list $(SOLUTION_PATH) package --outdated
	@echo "$(GREEN)âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯$(NC)"

# Ø¢Ù¾Ø¯ÛŒØª packages
update-packages: ## Ø¢Ù¾Ø¯ÛŒØª ØªÙ…Ø§Ù… packages
	@echo "$(YELLOW)â¬†ï¸  Ø¢Ù¾Ø¯ÛŒØª packages...$(NC)"
	dotnet list $(SOLUTION_PATH) package --outdated --format json | jq -r '.projects[].frameworks[].topLevelPackages[] | select(.resolvedVersion != .latestVersion) | "\(.id):\(.latestVersion)"' | while read package; do \
		dotnet add package $${package%:*} -v $${package#*:}; \
	done
	@echo "$(GREEN)âœ… Packages Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯Ù†Ø¯$(NC)"

# Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ development environment
setup-dev: install setup-db migrate ## Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡
	@echo "$(GREEN)ğŸ‰ Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!$(NC)"
	@echo "$(BLUE)ğŸ“‹ Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§: make dev$(NC)"
	@echo "$(BLUE)ğŸ“‹ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÙˆÙ†Ù‡: make generate-test-data$(NC)"

# deploy production
deploy-prod: clean install build test docker-build docker-push ## deploy Ú©Ø§Ù…Ù„ production
	@echo "$(GREEN)ğŸš€ Deploy production Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!$(NC)"

# Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡
info: ## Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡
	@echo "$(BLUE)ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡:$(NC)"
	@echo "Solution: $(SOLUTION_NAME)"
	@echo "API Project: $(API_PROJECT)"
	@echo "Domain Project: $(DOMAIN_PROJECT)"
	@echo "Application Project: $(APPLICATION_PROJECT)"
	@echo "Infrastructure Project: $(INFRASTRUCTURE_PROJECT)"
	@echo "Docker Image: $(DOCKER_IMAGE_NAME):$(DOCKER_TAG)"
	@echo ""
	@echo "$(GREEN)ğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯:$(NC)"
	@echo "Swagger UI: http://localhost:5000"
	@echo "Hangfire Dashboard: http://localhost:5000/hangfire"
	@echo "Health Check: http://localhost:5000/health"

# Quick start
quick-start: setup-dev generate-test-data ## Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ¹ (Ù†ØµØ¨ + Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ + Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÙˆÙ†Ù‡)
	@echo "$(GREEN)ğŸ‰ Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ¹ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!$(NC)"
	@echo "$(BLUE)ğŸš€ Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ 'make dev' Ø³Ø±ÙˆÛŒØ³ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯$(NC)"

# Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
default: help
